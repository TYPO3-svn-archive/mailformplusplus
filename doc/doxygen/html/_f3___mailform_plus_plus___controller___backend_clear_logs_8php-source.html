<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>mailformplusplus: F3_MailformPlusPlus_Controller_BackendClearLogs.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>F3_MailformPlusPlus_Controller_BackendClearLogs.php</h1><a href="_f3___mailform_plus_plus___controller___backend_clear_logs_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*                                                                        *</span>
<a name="l00003"></a>00003 <span class="comment"> * This script is part of the TYPO3 project - inspiring people to share!  *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                        *</span>
<a name="l00005"></a>00005 <span class="comment"> * TYPO3 is free software; you can redistribute it and/or modify it under *</span>
<a name="l00006"></a>00006 <span class="comment"> * the terms of the GNU General Public License version 2 as published by  *</span>
<a name="l00007"></a>00007 <span class="comment"> * the Free Software Foundation.                                          *</span>
<a name="l00008"></a>00008 <span class="comment"> *                                                                        *</span>
<a name="l00009"></a>00009 <span class="comment"> * This script is distributed in the hope that it will be useful, but     *</span>
<a name="l00010"></a>00010 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHAN-    *</span>
<a name="l00011"></a>00011 <span class="comment"> * TABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General      *</span>
<a name="l00012"></a>00012 <span class="comment"> * Public License for more details.                                       *</span>
<a name="l00013"></a>00013 <span class="comment"> *                                                                        */</span>
<a name="l00014"></a>00014 
<a name="l00022"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html">00022</a> <span class="keyword">class </span><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html">F3_MailformPlusPlus_Controller_BackendClearLogs</a> <span class="keyword">extends</span> <a class="code" href="class_f3___mailform_plus_plus___abstract_controller.html">F3_MailformPlusPlus_AbstractController</a> {
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00031"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#207b522c7a5e9588d95dea5f9214c772">00031</a>         <span class="keyword">protected</span> <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#207b522c7a5e9588d95dea5f9214c772">$componentManager</a>;
<a name="l00032"></a>00032 
<a name="l00039"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#b0753321ed6cf6b438c9fc1bf608c58f">00039</a>         <span class="keyword">protected</span> <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#b0753321ed6cf6b438c9fc1bf608c58f">$configuration</a>;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00049"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#badc729dc3783e74d3637fd822c78a8a">00049</a>         <span class="keyword">public</span> function <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#badc729dc3783e74d3637fd822c78a8a">__construct</a>(F3_GimmeFive_Component_Manager <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#207b522c7a5e9588d95dea5f9214c772">$componentManager</a>, <a class="code" href="class_f3___mailform_plus_plus___configuration.html">F3_MailformPlusPlus_Configuration</a> <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#b0753321ed6cf6b438c9fc1bf608c58f">$configuration</a>) {
<a name="l00050"></a>00050                 $this-&gt;componentManager = $componentManager;
<a name="l00051"></a>00051                 $this-&gt;configuration = $configuration;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00061"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#24888f1ec428f2be5bc0fa7b45d75821">00061</a>         <span class="keyword">protected</span> function <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#24888f1ec428f2be5bc0fa7b45d75821">init</a>() {
<a name="l00062"></a>00062                 global $LANG;
<a name="l00063"></a>00063                 $LANG-&gt;includeLLFile(<span class="stringliteral">'EXT:mailformplusplus/Resources/Language/locallang.xml'</span>);
<a name="l00064"></a>00064                 $templatePath = t3lib_extMgm::extPath(<span class="stringliteral">'mailformplusplus'</span>).<span class="stringliteral">'Resources/HTML/backend/'</span>;
<a name="l00065"></a>00065                 $templateFile = $templatePath.<span class="stringliteral">'template.html'</span>;
<a name="l00066"></a>00066                 $this-&gt;templateCode = t3lib_div::getURL($templateFile);
<a name="l00067"></a>00067         }
<a name="l00068"></a>00068 
<a name="l00074"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#8b31b995d28533313f209e132837889d">00074</a>         <span class="keyword">public</span> function <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#8b31b995d28533313f209e132837889d">process</a>() {
<a name="l00075"></a>00075                 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077                 <span class="comment">//init</span>
<a name="l00078"></a>00078                 $this-&gt;<a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#24888f1ec428f2be5bc0fa7b45d75821">init</a>();
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                 <span class="comment">//init gp params</span>
<a name="l00081"></a>00081                 $params = t3lib_div::_GP(<span class="stringliteral">'mailformplusplus'</span>);
<a name="l00082"></a>00082                 
<a name="l00083"></a>00083                 <span class="keywordflow">if</span>(isset($params[<span class="stringliteral">'clearTables'</span>]) &amp;&amp; is_array($params[<span class="stringliteral">'clearTables'</span>])) {
<a name="l00084"></a>00084                         $this-&gt;<a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#eb957295a06c0b49acf1818c28eb0036">clearTables</a>($params[<span class="stringliteral">'clearTables'</span>]);
<a name="l00085"></a>00085                 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#7f2daf8f84d8fc2c916a548f674e5d8f">getOverview</a>();
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089         
<a name="l00096"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#eb957295a06c0b49acf1818c28eb0036">00096</a>         <span class="keyword">protected</span> function <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#eb957295a06c0b49acf1818c28eb0036">clearTables</a>($tablesArray) {
<a name="l00097"></a>00097                 <span class="keywordflow">foreach</span>($tablesArray as $table) {
<a name="l00098"></a>00098                         $GLOBALS[<span class="stringliteral">'TYPO3_DB'</span>]-&gt;sql_query(<span class="stringliteral">'TRUNCATE '</span>.$table);
<a name="l00099"></a>00099                 }
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101         
<a name="l00108"></a><a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#7f2daf8f84d8fc2c916a548f674e5d8f">00108</a>         <span class="keyword">protected</span> function <a class="code" href="class_f3___mailform_plus_plus___controller___backend_clear_logs.html#7f2daf8f84d8fc2c916a548f674e5d8f">getOverview</a>() {
<a name="l00109"></a>00109                 global $LANG;
<a name="l00110"></a>00110                 $existingTables = $GLOBALS[<span class="stringliteral">'TYPO3_DB'</span>]-&gt;admin_get_tables();
<a name="l00111"></a>00111                 $code = <a class="code" href="class_f3___mailform_plus_plus___static_funcs.html#d96839bccce25d0888d19eccde1c9819">F3_MailformPlusPlus_StaticFuncs::getSubpart</a>($this-&gt;templateCode,<span class="stringliteral">'###CLEAR_LOGS###'</span>);
<a name="l00112"></a>00112                 $markers = array();
<a name="l00113"></a>00113                 $markers[<span class="stringliteral">'###URL###'</span>] = $_SERVER[<span class="stringliteral">'PHP_SELF'</span>];
<a name="l00114"></a>00114                 $markers[<span class="stringliteral">'###LLL:table###'</span>] = $LANG-&gt;getLL(<span class="stringliteral">'table'</span>);
<a name="l00115"></a>00115                 $markers[<span class="stringliteral">'###LLL:total_rows###'</span>] = $LANG-&gt;getLL(<span class="stringliteral">'total_rows'</span>);
<a name="l00116"></a>00116                 
<a name="l00117"></a>00117                 $markers[<span class="stringliteral">'###TABLES###'</span>] = <span class="stringliteral">''</span>;
<a name="l00118"></a>00118                 <span class="keywordflow">foreach</span>($existingTables as $table=&gt;$tableSettings) {
<a name="l00119"></a>00119                         
<a name="l00120"></a>00120                         
<a name="l00121"></a>00121                         <span class="keywordflow">if</span>(strpos($table,<span class="stringliteral">'tx_mailformplusplus_'</span>) &gt; -1) {
<a name="l00122"></a>00122                                 $res = $GLOBALS[<span class="stringliteral">'TYPO3_DB'</span>]-&gt;sql_query(<span class="stringliteral">'SELECT COUNT(*) as rowCount FROM '</span>.$table);
<a name="l00123"></a>00123                                 <span class="keywordflow">if</span>($res) {
<a name="l00124"></a>00124                                         $rowCode = <a class="code" href="class_f3___mailform_plus_plus___static_funcs.html#d96839bccce25d0888d19eccde1c9819">F3_MailformPlusPlus_StaticFuncs::getSubpart</a>($this-&gt;templateCode,<span class="stringliteral">'###CLEAR_LOGS_TABLE###'</span>);
<a name="l00125"></a>00125                                         $tableMarkers = array();
<a name="l00126"></a>00126                                         $row = $GLOBALS[<span class="stringliteral">'TYPO3_DB'</span>]-&gt;sql_fetch_assoc($res);
<a name="l00127"></a>00127                                         $tableMarkers[<span class="stringliteral">'###TABLE###'</span>] = $table;
<a name="l00128"></a>00128                                         $tableMarkers[<span class="stringliteral">'###ROW_COUNT###'</span>] = $row[<span class="stringliteral">'rowCount'</span>];
<a name="l00129"></a>00129                                         $GLOBALS[<span class="stringliteral">'TYPO3_DB'</span>]-&gt;sql_free_result($res);
<a name="l00130"></a>00130                                         $markers[<span class="stringliteral">'###TABLES###'</span>] .= <a class="code" href="class_f3___mailform_plus_plus___static_funcs.html#037c2a765183ddfa5864b1f26a2ac283">F3_MailformPlusPlus_StaticFuncs::substituteMarkerArray</a>($rowCode,$tableMarkers);
<a name="l00131"></a>00131                                 }
<a name="l00132"></a>00132                                 
<a name="l00133"></a>00133                         }
<a name="l00134"></a>00134                         
<a name="l00135"></a>00135                 }
<a name="l00136"></a>00136                 $markers[<span class="stringliteral">'###LLL:clear###'</span>] = $LANG-&gt;getLL(<span class="stringliteral">'clear_selected_tables'</span>);
<a name="l00137"></a>00137                 <span class="keywordflow">return</span> <a class="code" href="class_f3___mailform_plus_plus___static_funcs.html#037c2a765183ddfa5864b1f26a2ac283">F3_MailformPlusPlus_StaticFuncs::substituteMarkerArray</a>($code,$markers);
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 ?&gt;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Mar 31 11:33:51 2009 for mailformplusplus by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
